<div class="center">
    {{ __('config_title', APP_NAME) }}
    {{  APP_NAME | raw }}
    <h1>Just test</h1>
    {{  APP_VER | raw }}
</div>

{% block content %}
<div class="server-connections-container">
    <h2>{{ __('Połączenia do serwera', 'nazwaPluginu') }}</h2>

    {# Tabela z istniejącymi połączeniami #}
    {% if connections|length > 0 %}
        <div class="existing-connections">
            <h3>{{ __('Istniejące połączenia', 'nazwaPluginu') }}</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>{{ __('ID', 'nazwaPluginu') }}</th>
                        <th>{{ __('Nazwa serwera', 'nazwaPluginu') }}</th>
                        <th>{{ __('Adres IP', 'nazwaPluginu') }}</th>
                        <th>{{ __('Port', 'nazwaPluginu') }}</th>
                        <th>{{ __('Protokół', 'nazwaPluginu') }}</th>
                        <th>{{ __('Status', 'nazwaPluginu') }}</th>
                        <th>{{ __('Data utworzenia', 'nazwaPluginu') }}</th>
                        <th>{{ __('Akcje', 'nazwaPluginu') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for connection in connections %}
                        <tr>
                            <td>{{ connection.id }}</td>
                            <td>{{ connection.server_name }}</td>
                            <td>{{ connection.ip_address }}</td>
                            <td>{{ connection.port }}</td>
                            <td>{{ connection.protocol }}</td>
                            <td>
                                {% if connection.status == 1 %}
                                    <span class="badge bg-success">{{ __('Aktywne', 'nazwaPluginu') }}</span>
                                {% else %}
                                    <span class="badge bg-danger">{{ __('Nieaktywne', 'nazwaPluginu') }}</span>
                                {% endif %}
                            </td>
                            <td>{{ connection.date_created|date('Y-m-d H:i:s') }}</td>
                            <td>
                                <a href="{{ path('plugin_server_connection_edit', {'id': connection.id}) }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{{ path('plugin_server_connection_delete', {'id': connection.id}) }}" class="btn btn-sm btn-danger"
                                   onclick="return confirm('{{ __('Czy na pewno chcesz usunąć to połączenie?', 'nazwaPluginu') }}')">
                                    <i class="fas fa-trash"></i>
                                </a>
                                <a href="{{ path('plugin_server_connection_test', {'id': connection.id}) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-sync"></i> {{ __('Testuj', 'nazwaPluginu') }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info">
            {{ __('Brak zarejestrowanych połączeń do serwera.', 'nazwaPluginu') }}
        </div>
    {% endif %}

    {# Formularz do dodawania nowego połączenia #}
    <div class="new-connection-form">
        <h3>{{ __('Dodaj nowe połączenie', 'nazwaPluginu') }}</h3>
        <form method="post" action="{{ path('plugins/wazuh/front/config.php') }}" class="form">
            {{ csrf_token() }}

            <div class="form-group mb-3">
                <label for="server_name">{{ __('Nazwa serwera', 'nazwaPluginu') }} <span class="required">*</span></label>
                <input type="text" class="form-control" id="server_name" name="server_name" required>
            </div>

            <div class="form-group mb-3">
                <label for="ip_address">{{ __('Adres IP', 'nazwaPluginu') }} <span class="required">*</span></label>
                <input type="text" class="form-control" id="ip_address" name="ip_address" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$">
                <small class="form-text text-muted">{{ __('Format: xxx.xxx.xxx.xxx', 'nazwaPluginu') }}</small>
            </div>

            <div class="form-group mb-3">
                <label for="port">{{ __('Port', 'nazwaPluginu') }} <span class="required">*</span></label>
                <input type="number" class="form-control" id="port" name="port" required min="1" max="65535">
            </div>

            <div class="form-group mb-3">
                <label for="protocol">{{ __('Protokół', 'nazwaPluginu') }} <span class="required">*</span></label>
                <select class="form-control" id="protocol" name="protocol" required>
                    <option value="">{{ __('Wybierz protokół', 'nazwaPluginu') }}</option>
                    <option value="http">HTTP</option>
                    <option value="https">HTTPS</option>
                    <option value="ssh">SSH</option>
                    <option value="ftp">FTP</option>
                    <option value="sftp">SFTP</option>
                    <option value="other">{{ __('Inny', 'nazwaPluginu') }}</option>
                </select>
            </div>

            <div class="form-group mb-3" id="other_protocol_container" style="display: none;">
                <label for="other_protocol">{{ __('Inny protokół', 'nazwaPluginu') }}</label>
                <input type="text" class="form-control" id="other_protocol" name="other_protocol">
            </div>

            <div class="form-group mb-3">
                <label for="username">{{ __('Nazwa użytkownika', 'nazwaPluginu') }}</label>
                <input type="text" class="form-control" id="username" name="username">
            </div>

            <div class="form-group mb-3">
                <label for="password">{{ __('Hasło', 'nazwaPluginu') }}</label>
                <input type="password" class="form-control" id="password" name="password">
            </div>

            <div class="form-group mb-3">
                <label for="description">{{ __('Opis', 'nazwaPluginu') }}</label>
                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
            </div>

            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="active" name="active" checked>
                <label class="form-check-label" for="active">{{ __('Aktywne', 'nazwaPluginu') }}</label>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> {{ __('Dodaj połączenie', 'nazwaPluginu') }}
                </button>
                <button type="reset" class="btn btn-secondary">
                    <i class="fas fa-undo"></i> {{ __('Wyczyść', 'nazwaPluginu') }}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const protocolSelect = document.getElementById('protocol');
        const otherProtocolContainer = document.getElementById('other_protocol_container');

        protocolSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                otherProtocolContainer.style.display = 'block';
                document.getElementById('other_protocol').setAttribute('required', 'required');
            } else {
                otherProtocolContainer.style.display = 'none';
                document.getElementById('other_protocol').removeAttribute('required');
            }
        });
    });
</script>
{% endblock %}
